<!DOCTYPE html>
<html xmlns:th="http//www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml" xmlns="http://www.w3.org/1999/html"
      lang="en">
<head>
    <meta http-eqiv="Content-Type" content="text/html; charset=UTF-8"/>
    <title>Products</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
</head>
<body>
<div id="navbar" th:insert="navbar :: navbar"></div>
<div class="container">
    <!--    adding product (only for admin)-->
    <form sec:authorize="hasAuthority('ADMIN')" method="post" class="needs-validation" novalidate>
        <hr>
        <h4>ADD NEW PRODUCT</h4>
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
        <div class="container text-center">
            <div class="row">
                <div class="col-md-3">
                    <label for="productName">Product name</label>
                    <input type="text" class="form-control" id="productName" name="productName"
                           placeholder="Enter product name" aria-describedby="inputGroupPrepend" required>
                    <div class="invalid-feedback">
                        Please enter product name
                    </div>
                </div>
                <div class="col-md-3">
                    <label for="calories">Calories per 100g</label>
                    <input type="number" class="form-control" id="calories" name="calories"
                           placeholder="Calories per 100g" aria-describedby="inputGroupPrepend" required>
                    <div class="invalid-feedback">
                        Please enter calories
                    </div>
                </div>
                <div class="col-md-3 my-4">
                    <label for="category">Category</label>
                    <select name="category" id="category" required>
                        <option selected=""></option>
                        <option value="FRUITS">FRUITS</option>
                        <option value="VEGETABLES">VEGETABLES</option>
                        <option value="MEAT">MEAT</option>
                        <option value="FISH">FISH</option>
                        <option value="MILK">MILK</option>
                        <option value="SWEETS">SWEETS</option>
                        <option value="CEREALS">CEREALS</option>
                    </select>
                    <div class="invalid-feedback">Please select category</div>
                </div>
                <div class="col-md-3 my-4">
                    <button type="submit">Add new product</button>
                </div>
            </div>
        </div>
    </form>
    <hr>
    <h3 th:text="${message}" th:style="#{message} != 0? 'color: red': 'color: red'"></h3>
    <div class="font-weight-bold"><h4>List of Products</h4></div>
    <br>
    <!--    filter List of Products-->
    <div class="row">
        <div class="col">
            <form>
                <select id="filter" name="filter">
                    <option selected=""></option>
                    <option value="FRUITS">FRUITS</option>
                    <option value="VEGETABLES">VEGETABLES</option>
                    <option value="MEAT">MEAT</option>
                    <option value="FISH">FISH</option>
                    <option value="MILK">MILK</option>
                    <option value="SWEETS">SWEETS</option>
                    <option value="CEREALS">CEREALS</option>
                </select>
                <button type="submit">Filter by Category</button>
            </form>
        </div>
        <div class="col">
            </form>
            <form method="get">
                <select id="sort" name="sort">
                    <option selected=""></option>
                    <option value="nameAsc">Name ↑</option>
                    <option value="nameDesc">Name ↓</option>
                    <option value="CaloriesAsc">Calories ↑</option>
                    <option value="CaloriesDesc">Calories ↓</option>
                </select>
                <button type="submit">Sort by</button>
                <br>
            </form>
        </div>
    </div>
    <hr>
    <br>
    <table class="table table-striped">
        <thead>
        <tr>
            <th scope="col">NAME</th>
            <th scope="col">CATEGORY</th>
            <th scope="col">CALORIES (Per 100g)</th>
            <th scope="col"></th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="product : ${products}">
            <td th:text="${product.productName}"></td>
            <td th:text="${product.category}"></td>
            <td th:text="${product.caloriesPer100g}"></td>
            <td>
                <form sec:authorize="hasAuthority('ADMIN')" action="#" th:action="@{'products/delete/{id}'(id = ${product.id})}" th:method="delete">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <input type="hidden" name="id" th:value="${product.id}"/>
                    <button type="submit" class="btn btn-secondary">Delete</button>
                </form>
            </td>
        </tr>
        </tbody>
    </table>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.min.js"
        integrity="sha384-ODmDIVzN+pFdexxHEHFBQH3/9/vQ9uori45z4JjnFsRydbmQbmL5t1tQ0culUzyK"
        crossorigin="anonymous"></script>
<script>
(function() {
  'use strict';
  window.addEventListener('load', function() {
    var forms = document.getElementsByClassName('needs-validation');
    var validation = Array.prototype.filter.call(forms, function(form) {
      form.addEventListener('submit', function(event) {
        if (form.checkValidity() === false) {
          event.preventDefault();
          event.stopPropagation();
        }
        form.classList.add('was-validated');
      }, false);
    });
  }, false);
})();


</script>
</body>
</html>
